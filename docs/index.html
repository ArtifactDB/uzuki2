<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uzuki2: R lists to HDF5 or JSON</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">uzuki2
   </div>
   <div id="projectbrief">Recovering R lists faithfully from HDF5 or JSON</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">R lists to HDF5 or JSON </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/ArtifactDB/uzuki2/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/ArtifactDB/uzuki2/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/ArtifactDB/uzuki2"><img src="https://codecov.io/gh/ArtifactDB/uzuki2/branch/master/graph/badge.svg?token=J3dxS3MtT1" alt="codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p>The <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> repository describes a language-agnostic file format for serializing basic <a href="https://r-project.org">R</a> lists. List elements may be atomic vectors, <code>NULL</code>, or nested lists of such objects. It also supports missing values in the vectors and per-element names on the vectors or lists. A mechanism is also provided to handle external references to more complex objects (e.g., S4 classes) that cannot be directly saved into the format.</p>
<h1>Specifications</h1>
<p>We support serialization in either HDF5 or (possibly Gzip-compressed) JSON. Both of these are widely used formats and have complementary strengths for list representation. HDF5 supports random access into list components, which can provide optimization opportunities when the list is large and/or contains large atomic vectors. In contrast, JSON is easier to parse and has less storage overhead per list element.</p>
<p>Both the HDF5 and JSON specifications have multiple versions. Links to the version-specific HDF5 specifications are listed below, along with the minimum version of the C++ library required to parse them:</p>
<ul>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/hdf5-1.4.md">1.4</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.5.</li>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/hdf5-1.3.md">1.3</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.3.</li>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/hdf5-1.2.md">1.2</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.2.</li>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/hdf5-1.1.md">1.1</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.1.</li>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/hdf5-1.0.md">1.0</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.0.</li>
</ul>
<p>Similarly, different versions of the JSON specification are listed below:</p>
<ul>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/json-1.2.md">1.2</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.2.</li>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/json-1.1.md">1.1</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.1.</li>
<li><a href="https://github.com/ArtifactDB/uzuki2/tree/gh-pages/docs/specifications/json-1.0.md">1.0</a>, supported by <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> version ≥ 1.0.</li>
</ul>
<h1>Validation</h1>
<h2>Quick start</h2>
<p>A reference implementation of the validator is provided as a header-only C++ library in <a href="include/uzuki2"><code>include/uzuki2</code></a>. This is useful for portable deployment in different frameworks like R, Python, etc. We can check that a JSON/HDF5 file complies with the <b>uzuki</b> specification:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="uzuki2_8hpp.html">uzuki2/uzuki2.hpp</a>&quot;</span></div>
<div class="line"><a class="code hl_function" href="namespaceuzuki2_1_1hdf5.html#a2c3b06098aebbda4fcf51d32d8b340f4">uzuki2::hdf5::validate</a>(h5_file_path, h5_group_name, 0, {});</div>
<div class="line"><a class="code hl_function" href="namespaceuzuki2_1_1json.html#a5c8b849f53a52df5e2158823f60a3dd3">uzuki2::json::validate</a>(json_file_path, 0, {});</div>
<div class="ttc" id="anamespaceuzuki2_1_1hdf5_html_a2c3b06098aebbda4fcf51d32d8b340f4"><div class="ttname"><a href="namespaceuzuki2_1_1hdf5.html#a2c3b06098aebbda4fcf51d32d8b340f4">uzuki2::hdf5::validate</a></div><div class="ttdeci">void validate(const H5::Group &amp;handle, int num_external, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> parse_hdf5.hpp:607</div></div>
<div class="ttc" id="anamespaceuzuki2_1_1json_html_a5c8b849f53a52df5e2158823f60a3dd3"><div class="ttname"><a href="namespaceuzuki2_1_1json.html#a5c8b849f53a52df5e2158823f60a3dd3">uzuki2::json::validate</a></div><div class="ttdeci">void validate(byteme::Reader &amp;reader, int num_external, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> parse_json.hpp:525</div></div>
<div class="ttc" id="auzuki2_8hpp_html"><div class="ttname"><a href="uzuki2_8hpp.html">uzuki2.hpp</a></div><div class="ttdoc">Umbrella header for the uzuki2 library.</div></div>
</div><!-- fragment --><p>This will raise an error if any violations of the specification are observed. If a non-zero expected number of external objects is present:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="namespaceuzuki2_1_1hdf5.html#a2c3b06098aebbda4fcf51d32d8b340f4">uzuki2::hdf5::validate</a>(h5_file_path, h5_group_name, num_externals, {});</div>
</div><!-- fragment --><p>Each function accepts a <code>struct</code> of additional options to fine-tune its behavior:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="namespaceuzuki2_1_1json.html#a5c8b849f53a52df5e2158823f60a3dd3">uzuki2::json::validate</a>(json_file_path, 0, [&amp;]{</div>
<div class="line">    <a class="code hl_struct" href="structuzuki2_1_1json_1_1Options.html">uzuki2::json::Options</a> opt;</div>
<div class="line">    opt.<a class="code hl_variable" href="structuzuki2_1_1json_1_1Options.html#a81e2aaee989fdceb801cd0069f0d2b1a">strict_list</a> = <span class="keyword">false</span>;</div>
<div class="line">    opt.<a class="code hl_variable" href="structuzuki2_1_1json_1_1Options.html#ab3a08f0ea9132c8ae2980049b928b84d">buffer_size</a> = 1048576;</div>
<div class="line">    opt.<a class="code hl_variable" href="structuzuki2_1_1json_1_1Options.html#a9e42303766d0747c2b47e6f5f60d3443">parallel</a> = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">return</span> opt;</div>
<div class="line">}());</div>
<div class="ttc" id="astructuzuki2_1_1json_1_1Options_html"><div class="ttname"><a href="structuzuki2_1_1json_1_1Options.html">uzuki2::json::Options</a></div><div class="ttdoc">Options for JSON file parsing.</div><div class="ttdef"><b>Definition</b> parse_json.hpp:390</div></div>
<div class="ttc" id="astructuzuki2_1_1json_1_1Options_html_a81e2aaee989fdceb801cd0069f0d2b1a"><div class="ttname"><a href="structuzuki2_1_1json_1_1Options.html#a81e2aaee989fdceb801cd0069f0d2b1a">uzuki2::json::Options::strict_list</a></div><div class="ttdeci">bool strict_list</div><div class="ttdef"><b>Definition</b> parse_json.hpp:400</div></div>
<div class="ttc" id="astructuzuki2_1_1json_1_1Options_html_a9e42303766d0747c2b47e6f5f60d3443"><div class="ttname"><a href="structuzuki2_1_1json_1_1Options.html#a9e42303766d0747c2b47e6f5f60d3443">uzuki2::json::Options::parallel</a></div><div class="ttdeci">bool parallel</div><div class="ttdef"><b>Definition</b> parse_json.hpp:395</div></div>
<div class="ttc" id="astructuzuki2_1_1json_1_1Options_html_ab3a08f0ea9132c8ae2980049b928b84d"><div class="ttname"><a href="structuzuki2_1_1json_1_1Options.html#ab3a08f0ea9132c8ae2980049b928b84d">uzuki2::json::Options::buffer_size</a></div><div class="ttdeci">size_t buffer_size</div><div class="ttdef"><b>Definition</b> parse_json.hpp:406</div></div>
</div><!-- fragment --><p>Advanced users can also use the <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> parser to load the list into memory. This is achieved by calling <code>parse()</code> with custom provisioner and external reference classes. For example, <a href="tests/src/test_subclass.h"><code>tests/src/test_subclass.h</code></a> defines the <code>DefaultProvisioner</code> and <code>DefaultExternals</code> classes, which can be used to load the HDF5 contents into <code>std::vector</code>s for easier downstream operations.</p>
<div class="fragment"><div class="line">DefaultExternals ext(nexpected);</div>
<div class="line"><span class="keyword">auto</span> ptr = <a class="code hl_function" href="namespaceuzuki2_1_1hdf5.html#a44c67c6de55c5b336e6fb49579cf0f55">uzuki2::hdf5::parse&lt;DefaultProvisioner&gt;</a>(file_path, group_name, ext, {});</div>
<div class="ttc" id="anamespaceuzuki2_1_1hdf5_html_a44c67c6de55c5b336e6fb49579cf0f55"><div class="ttname"><a href="namespaceuzuki2_1_1hdf5.html#a44c67c6de55c5b336e6fb49579cf0f55">uzuki2::hdf5::parse</a></div><div class="ttdeci">ParsedList parse(const H5::Group &amp;handle, Externals_ ext, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> parse_hdf5.hpp:557</div></div>
</div><!-- fragment --><p>See the <a href="https://artifactdb.github.io/uzuki2">reference documentation</a> for more details.</p>
<h2>Building projects</h2>
<h3>CMake with <code>FetchContent</code></h3>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  uzuki2 </div>
<div class="line">  GIT_REPOSITORY https://github.com/ArtifactDB/uzuki2</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(uzuki2)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespaceuzuki2.html" title="Parse an R list from a HDF5 or JSON file.">uzuki2</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe uzuki2)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE uzuki2)</div>
</div><!-- fragment --><h3>CMake with <code>find_package()</code></h3>
<p>You can install the library by cloning a suitable version of this repository and running the following commands:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DUZUKI2_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>Then you can use <code>find_package()</code> as usual:</p>
<div class="fragment"><div class="line">find_package(artifactdb_uzuki2 CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE artifactdb::uzuki2)</div>
</div><!-- fragment --><h3>Manual</h3>
<p>If you're not using CMake, the simple approach is to just copy the files in the <code>include/</code> subdirectory - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. You will also need to link to the dependencies listed in the <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> directory, along with the HDF5 and Zlib libraries.</p>
<h1>Further comments</h1>
<p>See <a href="docs/specifications/misc.md#comparison-to-version-1">here</a> for a list of changes from the original <a href="https://github.com/LTLA/uzuki"><b>uzuki</b></a> library.</p>
<p>Just like the original <b>uzuki</b>, we're just re-using the reference to <a href="https://myanimelist.net/character/70883/Uzuki_Shimamura">Uzuki Shimamura</a> for the name:</p>
<p><img src="https://media1.giphy.com/media/7Oy2FDqWV5mak/giphy.gif" alt="Uzuki Shimamura" class="inline"/> </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
